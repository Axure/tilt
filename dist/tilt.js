// Tilt v1.0.0 - A micro script that simulates touch feedback on HTML elements.
// Copyright (c) 2015 Rik Schennink - http://rikschennink.github.io/tilt/
// License: MIT - http://www.opensource.org/licenses/mit-license.php
!function(t,e,n){"undefined"!=typeof module&&module.exports?module.exports=e(t):"function"==typeof define&&define.amd?define(e(t)):t.Tile=e(t)}(this,function(t,e){"use strict";function n(t,e){return t.hasOwnProperty(e)}function i(t,e){return-1!==e.indexOf(t.type)}function o(t,e,n){e.forEach(function(e){t.addEventListener(e,n,!1)})}function a(t,e,n){e.forEach(function(e){t.removeEventListener(e,n,!1)})}function r(t){return 0===t.type.indexOf("touch")&&(t=t.touches[0]||t.changedTouches[0]),{x:t.pageX,y:t.pageY}}function s(e){var n=e.getBoundingClientRect(),i=e&&e.ownerDocument,o=i.documentElement;return{top:n.top+t.pageYOffset-o.clientTop,left:n.left+t.pageXOffset-o.clientLeft,width:n.width,height:n.height}}function u(t){return/transform/i.test(t)}function h(t){var e,n={};return(t.getAttribute("style")||"").split(";").filter(function(t){return t.length}).map(function(t){e=t.split(":"),n[e[0]]=e[1]}),n}function p(t,e){var i,o="",a=h(t);for(i in a)n(a,i)&&(o+=i+":"+a[i]+";");for(i in e)n(e,i)&&(o+=i+":"+e[i]+";",u(i)&&(o+="-webkit-"+i+":"+e[i]+";"));t.style.cssText=o}function c(t){return t.map(function(t){return t.name+"("+t.value+")"}).join(" ")}function l(t,e){var i,o={},a=e||{};for(i in t)n(t,i)&&(o[i]="undefined"==typeof a[i]?t[i]:a[i]);return o}function f(t){return"none"===t?"50% 50%":t}function d(t){return/(left|right|center)/i.test(t)}function m(t){return/(top|bottom|center)/i.test(t)}function g(t,e,n){return Math.max(e,Math.min(t,n))}function v(t,e){var n=0,i=t.replace(x,function(t){return 0==n?(n++,t+" 25%"):t});return i.replace("(","("+e+"deg, ")}function _(t){var e=t.getAttribute("data-gradient");return e||(e=window.getComputedStyle(t).getPropertyValue("background-image"),t.setAttribute("data-gradient",e)),e}var b=125,y=".tilt {backface-visibility:hidden;-webkit-backface-visibility: hidden;-webkit-highlight:none;-webkit-tap-highlight-color:rgba(0,0,0,0);-webkit-transform-style:preserve-3d;transform-style:preserve-3d;-webkit-transition:-webkit-transform "+b+"ms;transition:transform "+b+"ms;overflow:hidden;position: relative;}.tilt-shadow-inner {position:absolute !important;opacity:0;top:0 !important;left:0 !important;right:0 !important;bottom:0 !important;z-index:2147483647 !important;background:linear-gradient(rgba(0,0,0,0), rgba(0,0,0,.25));-webkit-transition:opacity "+b+"ms;transition:opacity "+b+"ms;}",w=document.createElement("style");w.type="text/css",w.appendChild(document.createTextNode(y)),document.head.appendChild(w);var x=/(transparent|rgba.+?\))/gi,M={DOWN:["touchstart","pointerdown","mousedown"],UP:["touchend","touchcancel","pointerup","mouseup","dragend"]},T={top:180,right:270,bottom:0,left:90},k=function(t,e){this._element=t,this._options=l(k.options,e),this._tapTimeout=null,this._init()};return k.options={pivot:"center",depth:15,perspective:"500px",shadow:"rgba(0,0,0,.25)"},k.prototype={handleEvent:function(t){if(!this._tapTimeout)if(i(t,M.DOWN))this._onPush(t);else{this._onLift();var e=this;clearTimeout(this._tapTimeout),this._tapTimeout=setTimeout(function(){clearTimeout(e._tapTimeout),e._tapTimeout=null},b)}},wraps:function(t){return t===this._element},_init:function(){this._options.shadow&&"none"!==this._options.pivot&&(this._element.innerHTML+='<span class="tilt-shadow-inner"></span>'),o(this._element,M.DOWN,this),this._element.dataset.tileState="ready"},_onPush:function(t){o(document,M.UP,this);var e=r(t),n=s(this._element);this.tilt(e.x-n.left,e.y-n.top)},_onLift:function(){a(document,M.UP,this),this.untilt()},tilt:function(t,e){var n,i,o,a,r,u,h,l,b,y,w,x,M,k=this._options.depth,P=this._options.pivot;x={x:d(P),y:m(P)},n=s(this._element),t="undefined"==typeof t?.5*n.width:t,e="undefined"==typeof e?.5*n.height:e,t=g(t,0,n.width)/n.width,e=g(e,0,n.height)/n.height,a=180*Math.atan2(k,n.height*("center"===P?.5:1))/Math.PI,r=180*Math.atan2(k,n.width*("center"===P?.5:1))/Math.PI,h=x.x?"left"===P?0:"right"===P?1:.5:0,l=x.y?"top"===P?0:"bottom"===P?1:.5:0,i=x.y?(e-l)*("center"===P?2:1)*-a:0,o=x.x?(h-t)*("center"===P?2:1)*-r:0,u="none"===P?1:"center"===P?2*(1-Math.sin(.5+(Math.abs(h-t)+Math.abs(l-e)))):0,b=[{name:"perspective",value:this._options.perspective},{name:"rotateX",value:i+"deg"},{name:"rotateY",value:o+"deg"},{name:"translateZ",value:u*-k+"px"}],this._options.shadow&&"none"!==P&&(w=Math.max(Math.abs(i/a),Math.abs(o/r)),M="center"===P?90+180*Math.atan2(e-l,t-h)/Math.PI:T[P],y=this._element.querySelector(".tilt-shadow-inner"),p(y,{opacity:w,background:v(_(y),M)})),p(this._element,{"transform-origin":f(P),transform:c(b)}),this._element.dataset.tileState="pushed"},untilt:function(){var t,e,n=this._options.pivot;this._options.shadow&&"none"!==n&&(t=this._element.querySelector(".tilt-shadow-inner"),p(t,{opacity:0})),e=[{name:"perspective",value:this._options.perspective},{name:"rotateX",value:"0"},{name:"rotateY",value:"0"},{name:"translateZ",value:"0"}],p(this._element,{"transform-origin":f(n),transform:c(e)}),this._element.dataset.tileState="released"},unload:function(){a(this._element,M.DOWN,this),this._onLift()}},k});
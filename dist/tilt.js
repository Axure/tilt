// Tilt v1.0.0 - A micro script that simulates touch feedback on HTML elements.
// Copyright (c) 2015 Rik Schennink - http://rikschennink.github.io/tilt/
// License: MIT - http://www.opensource.org/licenses/mit-license.php
!function(t,e,n){"undefined"!=typeof module&&module.exports?module.exports=e(t):"function"==typeof define&&define.amd?define(e(t)):t.Tile=e(t)}(this,function(t,e){"use strict";function n(t,e){return t.hasOwnProperty(e)}function i(t,e){return-1!==e.indexOf(t.type)}function o(t,e,n){e.forEach(function(e){t.addEventListener(e,n,!1)})}function a(t,e,n){e.forEach(function(e){t.removeEventListener(e,n,!1)})}function r(t){return 0===t.type.indexOf("touch")&&(t=t.touches[0]||t.changedTouches[0]),{x:t.pageX,y:t.pageY}}function s(e){var n=e.getBoundingClientRect(),i=e&&e.ownerDocument,o=i.documentElement;return{top:n.top+t.pageYOffset-o.clientTop,left:n.left+t.pageXOffset-o.clientLeft,width:n.width,height:n.height}}function u(t){return/transform/i.test(t)}function h(t){var e,n={};return(t.getAttribute("style")||"").split(";").filter(function(t){return t.length}).map(function(t){e=t.split(":"),n[e[0]]=e[1]}),n}function c(t,e){var i,o="",a=h(t);for(i in a)n(a,i)&&(o+=i+":"+a[i]+";");for(i in e)n(e,i)&&(o+=i+":"+e[i]+";",u(i)&&(o+="-webkit-"+i+":"+e[i]+";"));t.style.cssText=o}function l(t){return t.map(function(t){return t.name+"("+t.value+")"}).join(" ")}function p(t,e){var i,o={},a=e||{};for(i in t)n(t,i)&&(o[i]="undefined"==typeof a[i]?t[i]:a[i]);return o}function f(t){return"none"===t?"50% 50%":t}function d(t){return/(left|right|center)/i.test(t)}function m(t){return/(top|bottom|center)/i.test(t)}function g(t,e,n){return Math.max(e,Math.min(t,n))}function v(t,e){var n=window.getComputedStyle(t),i=n.getPropertyValue("background-image"),o=0,a=i.replace(w,function(t){return 0==o?(o++,t+" 25%"):t});return a=e+"deg, "+a,"linear-gradient("+a+")"}var _=125,y=".tilt {backface-visibility:hidden;-webkit-backface-visibility: hidden;-webkit-highlight:none;-webkit-tap-highlight-color:rgba(0,0,0,0);-webkit-transform-style:preserve-3d;transform-style:preserve-3d;-webkit-transition:-webkit-transform "+_+"ms;transition:transform "+_+"ms;overflow:hidden;position: relative;}.tilt-shadow-inner {position:absolute;opacity:0;top:0;left:0;right:0;bottom:0;z-index:9999;background:linear-gradient(rgba(0,0,0,0), rgba(0,0,0,.25))-webkit-transition:opacity "+_+"ms;transition:opacity "+_+"ms;}",b=document.createElement("style");b.type="text/css",b.appendChild(document.createTextNode(y)),document.head.appendChild(b);var w=/(transparent|rgba.+?\))/gi,x={DOWN:["touchstart","pointerdown","mousedown"],UP:["touchend","touchcancel","pointerup","mouseup","dragend"]},M={top:180,right:270,bottom:0,left:90},T=function(t,e){this._element=t,this._options=p(T.options,e),this._tapTimeout=null,this._init()};return T.options={pivot:"center",depth:15,perspective:"500px",shadow:"rgba(0,0,0,.25)"},T.prototype={handleEvent:function(t){if(!this._tapTimeout)if(i(t,x.DOWN))this._onPush(t);else{this._onLift();var e=this;clearTimeout(this._tapTimeout),this._tapTimeout=setTimeout(function(){clearTimeout(e._tapTimeout),e._tapTimeout=null},_)}},wraps:function(t){return t===this._element},_init:function(){this._options.shadow&&"none"!==this._options.pivot&&(this._element.innerHTML+='<span class="tilt-shadow-inner"></span>'),o(this._element,x.DOWN,this),this._element.dataset.tileState="ready"},_onPush:function(t){o(document,x.UP,this);var e=r(t),n=s(this._element);this.tilt(e.x-n.left,e.y-n.top)},_onLift:function(){a(document,x.UP,this),this.untilt()},tilt:function(t,e){var n,i,o,a,r,u,h,p,_,y,b,w,x,T=this._options.depth,k=this._options.pivot;w={x:d(k),y:m(k)},n=s(this._element),t="undefined"==typeof t?.5*n.width:t,e="undefined"==typeof e?.5*n.height:e,t=g(t,0,n.width)/n.width,e=g(e,0,n.height)/n.height,a=180*Math.atan2(T,n.height*("center"===k?.5:1))/Math.PI,r=180*Math.atan2(T,n.width*("center"===k?.5:1))/Math.PI,h=w.x?"left"===k?0:"right"===k?1:.5:0,p=w.y?"top"===k?0:"bottom"===k?1:.5:0,i=w.y?(e-p)*("center"===k?2:1)*-a:0,o=w.x?(h-t)*("center"===k?2:1)*-r:0,u="none"===k?1:"center"===k?2*(1-Math.sin(.5+(Math.abs(h-t)+Math.abs(p-e)))):0,_=[{name:"perspective",value:this._options.perspective},{name:"rotateX",value:i+"deg"},{name:"rotateY",value:o+"deg"},{name:"translateZ",value:u*-T+"px"}],this._options.shadow&&"none"!==k&&(b=Math.max(Math.abs(i/a),Math.abs(o/r)),x="center"===k?90+180*Math.atan2(e-p,t-h)/Math.PI:M[k],y=this._element.querySelector(".tilt-shadow-inner"),c(y,{opacity:b,background:v(y,x)})),c(this._element,{"transform-origin":f(k),transform:l(_)}),this._element.dataset.tileState="pushed"},untilt:function(){var t,e,n=this._options.pivot;this._options.shadow&&"none"!==n&&(t=this._element.querySelector(".tilt-shadow-inner"),c(t,{opacity:0})),e=[{name:"perspective",value:this._options.perspective},{name:"rotateX",value:"0"},{name:"rotateY",value:"0"},{name:"translateZ",value:"0"}],c(this._element,{"transform-origin":f(n),transform:l(e)}),this._element.dataset.tileState="released"},unload:function(){a(this._element,x.DOWN,this),this._onLift()}},T});